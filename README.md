# slack_interactive

### Info
- 본 레포는 Slack으로 서버와 통신하여 유저가 정해진 명령어를 입력시 해당 동작을 서버에서 수행하는 코드가 담겨있습니다.
- 서버에는 local에 redis가 구동되고 있다고 가정되어있으며, 해당 정보는 conf에 기술되어 있어야 합니다. (뒤에 자세히 기술)
- 슬랙 token과 channel id는 사전에 기록되어있다고 가정합니다.
- interact 채널에서 명령어를 입력할 수 있으며, 수행된 메시지는 redis에 적재되어 두 번 수행되지 않습니다.
- 작동은 실시간이 아니며 1초 단위로 동작합니다. (준실시간)
- 에러 발생시 report 채널로 알람이 가며, 에러 감지 이후에는 1분간 작동하지 않습니다.

### conf 구성
- conf.json은 /conf/conf.json으로 구성되며, private한 정보이기 때문에 git에는 올라가지 않습니다. (.gitignore)
- conf는 다음과 같이 구성됩니다
```json
{
  "slack_bot_token": "",
  "redis":{
    "host": "",
    "port": "",
    "db":""
  },
  "slack_channel_ids": {
    "general": "",
    "report": "",
    "interact": ""
  },
  "history_period": 10
}
```

### 작동 순서 설명
1. 최근 10분간의 모든 메시지를 가져옵니다
    - 10분이라는 기간은 conf.json에서 history_period라는 파라미터로 조율이 가능합니다
    - 준실시간으로 동작할 것이기 때문에 더 작아도 큰 상관은 없습니다
2. 가져온 메시지 중 레디스에 적재된 것은 제거합니다.
    - key값은 "{USER_ID}_{MESSATE_TS}"형태입니다. 
    - 처리한 메시지를 중복처리하지 않기 위함입니다.
3. 남은 메시지 중 등록된 명령어와 일치하는 메시지가 존재할 시 이를 수행합니다.
    - 기본적으로 모든 처리는 스레드에 댓글을 남기는 방식입니다.
4. 처리된 메시지를 레디스에 적재합니다.
5. 1~4를 반복합니다. 

### 등록된 명령어
1. "지금 시각은?"
    - 현재 시각을 반환합니다. (스레드에)
2. "redis에 메시지 몇 개 적재됐어?"
    - 현재 레디스에 적재된 메시지 수를 반환합니다.
3. "redis 싹 비워!"
    - 현재 레디스에 적재된 모든 메시지를 삭제합니다.

### 참조 자료
- https://api.slack.com/

